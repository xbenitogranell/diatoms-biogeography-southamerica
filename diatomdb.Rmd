---
title: "Tropical South American Diatom Database"
author: "Xavier Benito"
date: "1/13/2019"
output: github_document
#runtime: shiny
#always_allow_html: yes

---


This repository contains a georeferenced inventory of sites of diatom samples in tropical South America. 
The database includes diatom (unicelular siliceous algae) data and associated environmental variables of waterbody sites (streams, wetlands and lakes), covering an altitudinal gradient from 220 to 5,070 m a.s.l. between 8°N–30°S and 58–79°W.

More info: http://www.xavierbenito.com/bgsa/bgsa.html 

```{r}
library(leaflet)
library(tidyverse)
library(shiny)
```

Load inventory of sites
```{r}
diatom_data <- read.csv("Diatom_Biogeography_South_America_DB-def.csv", stringsAsFactors = FALSE)

head(diatom_data)
```

Filter out certain sites
```{r}
diatom_subset <- diatom_data %>% filter(!region=="Tierra del Fuego" & !Habitat=="channel")

```

Create a leaflet map
```{r}
map <- leaflet() %>% 
  addProviderTiles("Esri.WorldImagery") %>% 
  addMarkers(lat = diatom_subset$lat, 
             lng = diatom_subset$long,
             clusterOptions = markerClusterOptions(),
             popup = paste("<strong>", "Site: ", "</strong>", as.character(diatom_subset$SiteName), "<br>",
                           "<strong>", "Habitat: ", "</strong>", as.character(diatom_subset$Habitat), "<br>",
                           "<strong>", "Sample type: ", "</strong>", as.character(diatom_subset$SampleType), "<br>",
                           "<strong>", "Collection: ", "</strong>", as.character(diatom_subset$Collection)))
                           

map
```


Create a shiny app to display habitat types
```{r TheShinyExample, warning = FALSE}
shinyApp(
  ui = fluidPage(
     tags$div(title = "This input has a tool tip",
             selectInput(inputId = "habitat", 
                         label = "Habitat type", 
                         choices = sort(unique(diatom_subset$Habitat)))),
    leafletOutput("MapPlot1")
  ),
  
  server = function(input, output) {
    
    output$MapPlot1 <- renderLeaflet({
      leaflet() %>% 
        addProviderTiles("Esri.WorldImagery") %>% 
        setView(lng = -68, lat = -15, zoom = 3)
    })
    
    observe({
      
      habitat <- input$habitat
      
      sites <- diatom_subset %>% 
        filter(diatom_subset$Habitat %in% habitat)
      
   leafletProxy("MapPlot1") %>% clearMarkers() %>% 
   addCircleMarkers(lng = sites$long,
                   lat = sites$lat,
                   popup = paste("<strong>", "Site: ", "</strong>", as.character(sites$SiteName), "<br>",
                                 "<strong>", "Habitat: ", "</strong>", as.character(sites$Habitat), "<br>",
                                 "<strong>", "Sample type: ", "</strong>", as.character(sites$SampleType), "<br>",
                                 "<strong>", "Collection: ", "</strong>", as.character(sites$Collection)))

    })
  },
  options = list(height = 600)
)


```

